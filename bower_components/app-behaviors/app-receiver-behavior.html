<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../expandjs/expandjs.html"><link rel="import" href="../xp-elements/xp-master-slave-behavior.html"><link rel="import" href="app-locale-behavior.html"><script>

    /**
     * @polymerBehavior Polymer.APPReceiverBehaviorImp
     */
    Polymer.APPReceiverBehaviorImp = {

        /**
         * Invokes an application's command.
         *
         * @method invoke
         * @param {string} command
         * @param {Object} [options]
         * @param {Function} [callback]
         */
        invoke(command, options, callback) {

            // Preparing
            if (XP.isFunction(options)) { callback = options; options = undefined; }
            if (XP.isVoid(callback)) { callback = function () {}; }

            // Asserting
            XP.assertArgument(XP.isString(command, true), 1, 'string');
            XP.assertArgument(XP.isVoid(options) || XP.isObject(options), 2, 'Object');
            XP.assertArgument(XP.isFunction(callback), 3, 'Function');

            // Invoking
            if (this.shell) { return this.shell.invoke(command, options, callback); }
        },

        /*********************************************************************/

        // PROPERTIES
        properties: {

            /**
             * The application's state.
             *
             * @attribute app
             * @type Object
             * @notifies
             * @readonly
             */
            app: {
                notify: true,
                readOnly: true,
                type: Object
            },

            /**
             * The authentication's state.
             *
             * @attribute auth
             * @type Object
             * @notifies
             * @readonly
             */
            auth: {
                notify: true,
                readOnly: true,
                type: Object
            },

            /**
             * The application's namespace.
             *
             * @attribute namespace
             * @type string
             * @default ""
             * @readonly
             */
            namespace: {
                computed: 'computeValue(shell, "namespace")',
                type: String,
                value: ''
            },

            /**
             * The application's shell.
             *
             * @attribute shell
             * @type Element
             * @readonly
             */
            shell: {
                master: '.shell',
                observer: '__shellChanged',
                readOnly: true
            },

            /**
             * The application's store.
             *
             * @attribute store
             * @type Element
             * @readonly
             */
            store: {
                observer: '__storeChanged',
                readOnly: true
            }
        },

        /*********************************************************************/

        // OBSERVER
        __shellChanged(post) {

            // Listening
            this[post ? 'listen' : 'unlisten'](window, 'offline', '__handleOffline');
            this[post ? 'listen' : 'unlisten'](window, 'online', '__handleOffline');

            // Ensuring
            this.async(() => this.ensure('store', post && post.store));
        },

        // OBSERVER
        __storeChanged(post, pre) {

            // Linking
            if (pre) { this.unlinkProperties('app', 'app', pre); }
            if (pre) { this.unlinkProperties('auth', 'auth', pre); }
            if (post) { this.linkProperties('app', 'app', post); }
            if (post) { this.linkProperties('auth', 'auth', post); }

            // Ensuring
            if (post) { this.ensure('app', post.app); }
            if (post) { this.ensure('auth', post.auth); }
        }
    };

    /**
     * @polymerBehavior Polymer.APPReceiverBehavior
     */
    Polymer.APPReceiverBehavior = [
        Polymer.XPMasterSlaveBehavior,
        Polymer.APPLocaleBehavior,
        Polymer.APPReceiverBehaviorImp
    ];
</script></head><body></body></html>